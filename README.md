# Image Processor

–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —Å–µ—Ä–≤–∏—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º. –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, —Å—Ç–∞–≤–∏—Ç—å –∑–∞–¥–∞—á–∏ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –≤ –æ—á–µ—Ä–µ–¥—å (Apache Kafka), –∏ –ø–æ–ª—É—á–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
image-processor/
‚îú‚îÄ‚îÄ cmd/imageprocessor/          # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ main.go
‚îú‚îÄ‚îÄ internal/                    # –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –ª–æ–≥–∏–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ api/                    # HTTP API —Å–ª–æ–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ handler/           # HTTP –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ create.go      # POST /upload
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ get.go         # GET /image/{id}, GET /image/info/{id}
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ delete.go      # DELETE /image/{id}
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ handler.go     # –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Handler
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ interface.go   # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã —Å–µ—Ä–≤–∏—Å–æ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ response/          # HTTP –æ—Ç–≤–µ—Ç—ã
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ response.go
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ router/            # –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ router.go
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ server/           # HTTP —Å–µ—Ä–≤–µ—Ä
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ server.go
‚îÇ   ‚îú‚îÄ‚îÄ config/               # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config.go
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ types.go
‚îÇ   ‚îú‚îÄ‚îÄ kafka/               # Kafka –∫–ª–∏–µ–Ω—Ç
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ kafka.go
‚îÇ   ‚îú‚îÄ‚îÄ model/              # –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ model.go
‚îÇ   ‚îú‚îÄ‚îÄ repository/         # –°–ª–æ–π –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ minio/         # MinIO (—Ñ–∞–π–ª–æ–≤–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ minio.go
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ postgres/      # PostgreSQL (–º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ)
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ create.go
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ delete.go
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ get.go
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ update.go
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ repo.go
‚îÇ   ‚îî‚îÄ‚îÄ service/           # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ       ‚îú‚îÄ‚îÄ create.go      # –°–æ–∑–¥–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
‚îÇ       ‚îú‚îÄ‚îÄ delete.go      # –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
‚îÇ       ‚îú‚îÄ‚îÄ get.go         # –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
‚îÇ       ‚îú‚îÄ‚îÄ images.go      # –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
‚îÇ       ‚îú‚îÄ‚îÄ interface.go   # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
‚îÇ       ‚îú‚îÄ‚îÄ service.go    # –û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–∏—Å
‚îÇ       ‚îú‚îÄ‚îÄ utils.go       # –£—Ç–∏–ª–∏—Ç—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏
‚îÇ       ‚îî‚îÄ‚îÄ workers.go     # –§–æ–Ω–æ–≤—ã–µ –≤–æ—Ä–∫–µ—Ä—ã
‚îú‚îÄ‚îÄ migrations/            # SQL –º–∏–≥—Ä–∞—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ 20251006163803_message_table.sql
‚îú‚îÄ‚îÄ web/                  # –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
‚îÇ   ‚îú‚îÄ‚îÄ index.html        # –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
‚îÇ   ‚îú‚îÄ‚îÄ styles.css        # –°—Ç–∏–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ app.js           # JavaScript –ª–æ–≥–∏–∫–∞
‚îÇ   ‚îî‚îÄ‚îÄ font.ttf         # –®—Ä–∏—Ñ—Ç –¥–ª—è –≤–æ–¥—è–Ω—ã—Ö –∑–Ω–∞–∫–æ–≤
‚îú‚îÄ‚îÄ env/                 # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ config.yaml
‚îú‚îÄ‚îÄ docker-compose.yml   # Docker –æ–∫—Ä—É–∂–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ Dockerfile          # Docker –æ–±—Ä–∞–∑
‚îú‚îÄ‚îÄ go.mod             # Go –º–æ–¥—É–ª–∏
‚îî‚îÄ‚îÄ go.sum
```

## üöÄ –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞
```bash
git clone <repository-url>
cd image-processor
```

### 2. –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
```bash
docker-compose up --build -d
```

–≠—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç:
- **PostgreSQL** (–ø–æ—Ä—Ç 5432) - –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
- **MinIO** (–ø–æ—Ä—Ç 9000) - —Ñ–∞–π–ª–æ–≤–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
- **Kafka + Zookeeper** - –æ—á–µ—Ä–µ–¥—å —Å–æ–æ–±—â–µ–Ω–∏–π
- **Image Processor** (–ø–æ—Ä—Ç 8080) - –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker-compose ps

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
docker-compose logs -f image-processor
```

### 4. –î–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–∏—Å–∞–º
- **–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å**: http://localhost:8080
- **MinIO Console**: http://localhost:9001 (admin/admin123)
- **PostgreSQL**: localhost:5432 (postgres/postgres)

## üåê –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

–û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:8080 –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É.

### –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
- **üì§ –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π** - drag & drop –∏–ª–∏ –≤—ã–±–æ—Ä —Ñ–∞–π–ª–∞
- **‚öôÔ∏è –í—ã–±–æ—Ä –∑–∞–¥–∞—á –æ–±—Ä–∞–±–æ—Ç–∫–∏**:
  - `resize` - –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞
  - `miniature generating` - —Å–æ–∑–¥–∞–Ω–∏–µ –º–∏–Ω–∏–∞—Ç—é—Ä
  - `watermark` - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–æ–¥—è–Ω—ã—Ö –∑–Ω–∞–∫–æ–≤
- **üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å—Ç–∞—Ç—É—Å–∞** - —Ä–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
- **üñºÔ∏è –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
- **üíæ –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤** - –≤ –ø–∞–ø–∫—É –∑–∞–≥—Ä—É–∑–æ–∫ –±—Ä–∞—É–∑–µ—Ä–∞
- **üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π** - —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º

### –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å:
- **–¢—ë–º–Ω–∞—è —Ç–µ–º–∞** —Å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º –¥–∏–∑–∞–π–Ω–æ–º
- **–ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –≤–µ—Ä—Å—Ç–∫–∞** –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** –æ —Å—Ç–∞—Ç—É—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–π
- **–ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä—ã** –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏

## üì° API Endpoints

### POST /api/upload
–ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É.

**Content-Type**: `multipart/form-data`

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
- `image` (file) - —Ñ–∞–π–ª –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (PNG, JPEG, GIF)
- `metadata` (string) - JSON —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –∑–∞–¥–∞—á–∏

**–ü—Ä–∏–º–µ—Ä metadata**:
```json
{
  "task": "resize",
  "content_type": "image/jpeg",
  "watermark_string": "¬© My Brand",
  "resize": {
    "width": 800,
    "height": 600
  }
}
```

**–û—Ç–≤–µ—Ç**:
```json
{
  "result": "550e8400-e29b-41d4-a716-446655440000"
}
```

### GET /api/image/{id}
–ü–æ–ª—É—á–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
- `id` (string) - UUID –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

**–û—Ç–≤–µ—Ç**: –ë–∏–Ω–∞—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–ª–∏ JSON —Å –æ—à–∏–±–∫–æ–π

### GET /api/image/info/{id}
–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å—Ç–∞—Ç—É—Å–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
- `id` (string) - UUID –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

**–û—Ç–≤–µ—Ç**:
```json
{
  "result": {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "status": "finished",
    "created_at": "2025-10-07T19:25:32Z"
  }
}
```

### DELETE /api/image/{id}
–£–¥–∞–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
- `id` (string) - UUID –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

**–û—Ç–≤–µ—Ç**:
```json
{
  "result": "Image deleted successfully"
}
```

## üîß –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –∑–∞–¥–∞—á–∏

### 1. Resize (–∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞)
```json
{
  "task": "resize",
  "resize": {
    "width": 800,
    "height": 600
  }
}
```

### 2. Thumbnail (–º–∏–Ω–∏–∞—Ç—é—Ä–∞)
```json
{
  "task": "miniature generating"
}
```
–°–æ–∑–¥–∞—ë—Ç –º–∏–Ω–∏–∞—Ç—é—Ä—É 200x200 –ø–∏–∫—Å–µ–ª–µ–π.

### 3. Watermark (–≤–æ–¥—è–Ω–æ–π –∑–Ω–∞–∫)
```json
{
  "task": "watermark",
  "watermark_string": "¬© My Brand"
}
```

## üõ†Ô∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Backend**: Go, Gin, PostgreSQL, MinIO, Apache Kafka
- **Frontend**: HTML5, CSS3, JavaScript (Vanilla)
- **Containerization**: Docker, Docker Compose
- **Image Processing**: Go image packages, OpenType fonts

## üìù –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `env/config.yaml`:
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö PostgreSQL
- MinIO —Ñ–∞–π–ª–æ–≤–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
- Kafka –±—Ä–æ–∫–µ—Ä
- –î–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

- **–õ–æ–≥–∏**: —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ JSON –ª–æ–≥–∏
- **–ú–µ—Ç—Ä–∏–∫–∏**: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- **–°—Ç–∞—Ç—É—Å**: HTTP health checks
- **–û—á–µ—Ä–µ–¥—å**: –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Kafka —Ç–æ–ø–∏–∫–æ–≤

## üö® –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

- –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–æ–≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–æ–≤ —Ñ–∞–π–ª–æ–≤
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å–µ—Ç–∏
- Retry –º–µ—Ö–∞–Ω–∏–∑–º—ã –¥–ª—è Kafka
- Graceful shutdown –≤–æ—Ä–∫–µ—Ä–æ–≤

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞**: 3 –≤–æ—Ä–∫–µ—Ä–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ—Ä–∫–µ—Ä–æ–≤
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –≤ –ø–∞–º—è—Ç–∏
